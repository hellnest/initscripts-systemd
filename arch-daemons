#!/bin/bash
#
# /lib/systemd/system-generators/arch-daemons
#

. /etc/rc.conf

[[ $1 ]] || exit 1

# The first argument is the path to which the generated files should be written
dest=$1

# Make service file
create_unit() {
echo "[Unit]"
echo "Description=Legacy service for $1"
echo "After=$2"
echo "[Service]"
echo "ExecStart=/etc/rc.d/$1 start"
echo "ExecStop=/etc/rc.d/$1 stop"
echo "RemainAfterExit=yes"
echo "Type=forking"
}

[[ -d $dest/arch-daemons.target.wants ]] || /bin/mkdir -p $dest/arch-daemons.target.wants

for daemon in "${DAEMONS[@]}"; do
  case ${daemon:0:1} in
    '!') continue ;;
    '@') create_unit ${daemon:1} $dep > "$dest/arch-daemons.target.wants/${daemon:1}.service";;
    *) create_unit $daemon $dep > "$dest/arch-daemons.target.wants/$daemon.service"
       dep=$daemon.service ;;
   esac
done

# vim: et sw=2:
